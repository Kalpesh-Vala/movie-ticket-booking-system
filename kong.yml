_format_version: "3.0"
_transform: true

services:
  # User Service
  - name: user-service
    url: http://user-service:8080
    tags:
      - user
      - authentication

  # Cinema Service  
  - name: cinema-service
    url: http://cinema-service:8002
    tags:
      - cinema
      - movies

  # Booking Service (GraphQL)
  - name: booking-service
    url: http://booking-service:8004
    tags:
      - booking
      - graphql

  # Payment Service
  - name: payment-service
    url: http://payment-service:8003
    tags:
      - payment

  # Notification Service
  - name: notification-service
    url: http://notification-service:8084
    tags:
      - notification

routes:
  # User Service Routes
  - name: user-routes
    service: user-service
    paths:
      - /api/users
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    protocols:
      - http
      - https
    strip_path: true

  # Cinema Service Routes
  - name: cinema-routes
    service: cinema-service
    paths:
      - /api/v1/cinemas
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    protocols:
      - http
      - https
    strip_path: false

  # Booking Service Routes
  - name: booking-routes
    service: booking-service
    paths:
      - /api/bookings
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    protocols:
      - http
      - https
    strip_path: true

  # Booking Service GraphQL
  - name: booking-graphql
    service: booking-service
    paths:
      - /graphql
    methods:
      - GET
      - POST
      - OPTIONS
    protocols:
      - http
      - https
    strip_path: false

  # Payment Service Routes
  - name: payment-routes
    service: payment-service
    paths:
      - /api/payments
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    protocols:
      - http
      - https
    strip_path: true

  # Notification Service Routes
  - name: notification-routes
    service: notification-service
    paths:
      - /api/notifications
    methods:
      - GET
      - POST
      - PUT
      - DELETE
      - OPTIONS
    protocols:
      - http
      - https
    strip_path: true

plugins:
  # Global CORS Plugin
  - name: cors
    config:
      origins:
        - "*"
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-MD5
        - Content-Type
        - Date
        - Authorization
      exposed_headers:
        - X-Auth-Token
      credentials: true
      max_age: 3600
    tags:
      - cors

  # Global Rate Limiting Plugin
  - name: rate-limiting
    config:
      minute: 1000
      policy: local
      hide_client_headers: false
      fault_tolerant: true
    tags:
      - rate-limiting